# 05. Server & Edge 명세 (Spec)

## 존재 의의
Server는 실제 사용자 요청을 실행하는 **데이터 플레인**이다. Edge에서 로직을 실행하고 지연을 최소화한다.

## 핵심 행동
- 로직 번들 로드
- 인증/권한 체크
- SQL/JS 실행
- 캐시 적용

## 상태 표기
- ✅ 구현됨
- 🟡 부분 구현
- ❌ 미구현

## 런타임 API

### `POST /call`
- **존재 의의**: SDK와 표준 API 호출 경로
- **행동**: `{ path, params }`로 로직 실행
- **동작**:
  1) KV에서 번들 로드
  2) 인증/권한 검증
  3) 파라미터 머지/검증
  4) SQL 또는 JS 실행
  5) 결과 반환
- **상태**: ✅

## 캐시 정책
- **존재 의의**: Edge 응답 성능 개선
- **행동**: `cache` 설정이 있는 public 로직만 캐시
- **동작**: params 안정적 직렬화 → Cache API 저장/조회
- **상태**: ✅

## 인증/권한
- **존재 의의**: 공개/보호 API 구분
- **행동**: JWT 검증 및 access 제어
- **동작**: `public`은 허용, `authenticated`/role은 토큰 필요
- **상태**: ✅

## Private 로직
- **존재 의의**: 내부 전용 로직 분리
- **행동**: `_` prefix는 외부 호출 거부
- **동작**: 런타임에서 차단
- **상태**: ✅

## DB 연결
- **존재 의의**: SQL 로직 실행
- **행동**: DB 프록시를 통해 쿼리 실행
- **동작**: Cloudflare는 Hyperdrive + Neon Serverless
- **상태**: 🟡 (다른 런타임은 단순 어댑터)

## 스토리지
- **존재 의의**: 업/다운로드 URL 생성 및 파일 삭제
- **행동**: S3/R2 호환 presign, DELETE 호출
- **동작**: SigV4 presign 사용
- **상태**: ✅
