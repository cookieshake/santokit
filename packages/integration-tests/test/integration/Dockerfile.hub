FROM golang:1.23-bookworm AS builder
WORKDIR /app
ENV GOTOOLCHAIN=auto
COPY packages/hub ./packages/hub
WORKDIR /app/packages/hub
RUN go build -o /usr/local/bin/hub cmd/hub/main.go

FROM debian:bookworm-slim
COPY --from=builder /usr/local/bin/hub /usr/local/bin/hub
ENV STK_HUB_ADDR=:8080
ENV STK_ENCRYPTION_KEY=32-byte-key-for-aes-256-gcm!!!!!
EXPOSE 8080
CMD ["hub"]
